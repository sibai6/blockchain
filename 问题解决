# ğŸ› ï¸ é—®é¢˜è§£å†³æŒ‡å—

## ğŸ“¦ ç¯å¢ƒé…ç½®

### è½¯ä»¶ç‰ˆæœ¬å†²çª

å¤šä¸ªç‰ˆæœ¬çš„ Go/Node.js å¯èƒ½å¯¼è‡´å‘½ä»¤å¼‚å¸¸ï¼Œå»ºè®®æ¸…ç†åä½¿ç”¨ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚

```bash
# æ£€æŸ¥å·²å®‰è£…ç‰ˆæœ¬
which -a go
which -a node

# å¸è½½æ—§ç‰ˆæœ¬
sudo apt remove golang-go
sudo apt autoremove
```

Go æ¨èä½¿ç”¨ gvmï¼š
```bash
bash < <(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)
```

Node.js æ¨èä½¿ç”¨ nvmï¼š
```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
```

### å›½å†…é•œåƒåŠ é€Ÿ

#### Go æ¨¡å—ä»£ç†

```bash
export GOPROXY=https://goproxy.cn,direct
export GOSUMDB=sum.golang.google.cn

# æ°¸ä¹…ç”Ÿæ•ˆ
echo 'export GOPROXY=https://goproxy.cn,direct' >> ~/.bashrc
```

#### NPM é•œåƒæº

```bash
npm config set registry https://registry.npmmirror.com
npm config get registry  # éªŒè¯é…ç½®
```

#### Docker é•œåƒåŠ é€Ÿ

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```bash
sudo vim /etc/docker/daemon.json
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```json
{
  "registry-mirrors": [
    "https://mirror.ccs.tencentyun.com",
    "https://docker.mirrors.ustc.edu.cn"
  ]
}
```

é‡å¯ Dockerï¼š
```bash
sudo systemctl restart docker
```

#### Ubuntu APT æº

```bash
# å¤‡ä»½åŸæ–‡ä»¶
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

# æ›¿æ¢ä¸ºé˜¿é‡Œäº‘é•œåƒ
sudo sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
sudo apt update
```

## ğŸŒ ç½‘ç»œé…ç½®

### ç«¯å£å ç”¨å†²çª

æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µï¼š
```bash
sudo lsof -i :8545
sudo netstat -tulpn | grep 8545
```

ç»ˆæ­¢å ç”¨è¿›ç¨‹ï¼š
```bash
sudo kill -9 <PID>
```

ä¿®æ”¹é»˜è®¤ç«¯å£ï¼š
```bash
geth --datadir ./node1 --port 30304 --http.port 8546
```

### é˜²ç«å¢™é…ç½®

ä½¿ç”¨ UFWï¼š
```bash
sudo ufw allow 30303/tcp  # P2P ç«¯å£
sudo ufw allow 8545/tcp   # RPC ç«¯å£
sudo ufw enable
```

ä½¿ç”¨ iptablesï¼š
```bash
sudo iptables -A INPUT -p tcp --dport 30303 -j ACCEPT
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

### èŠ‚ç‚¹äº’è”å¤±è´¥

è¿›å…¥æ§åˆ¶å°æ£€æŸ¥ï¼š
```bash
geth attach http://localhost:8545
```

æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š
```javascript
> admin.nodeInfo.enode
```

æ‰‹åŠ¨æ·»åŠ å¯¹ç­‰èŠ‚ç‚¹ï¼š
```javascript
> admin.addPeer("enode://...")
```

æ£€æŸ¥è¿æ¥çŠ¶æ€ï¼š
```javascript
> net.peerCount
> admin.peers
```

ä¹Ÿå¯ä»¥åˆ›å»º `static-nodes.json` æ–‡ä»¶ï¼š
```json
[
  "enode://pubkey1@ip1:30303",
  "enode://pubkey2@ip2:30303",
  "enode://pubkey3@ip3:30303"
]
```

## ğŸ“ è·¯å¾„ä¸æƒé™

### æƒé™é”™è¯¯

è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰è€…ï¼š
```bash
sudo chown -R $USER:$USER ./blockchain-data
```

è®¾ç½®é€‚å½“æƒé™ï¼š
```bash
chmod 700 ./blockchain-data
chmod 600 ./blockchain-data/keystore/*
```

### æ¨èç›®å½•ç»“æ„

```
blockchain-network/
â”œâ”€â”€ node1/
â”‚   â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ keystore/
â”‚   â””â”€â”€ genesis.json
â”œâ”€â”€ node2/
â”œâ”€â”€ node3/
â”œâ”€â”€ node4/
â”œâ”€â”€ scripts/
â””â”€â”€ config/
```

ä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…æ··æ·†ï¼š
```bash
DATADIR=/home/user/blockchain-network/node1
geth --datadir $PWD/node1/data
```

## â›“ï¸ åˆ›ä¸–åŒºå—

### åˆå§‹åŒ–å¤±è´¥

å¸¸è§åŸå› ï¼š
- chainId å†²çªï¼ˆé¿å…ä½¿ç”¨ 1ã€3ã€4 ç­‰å…¬é“¾ IDï¼‰
- JSON æ ¼å¼é”™è¯¯
- é…ç½®å‚æ•°ä¸åŒ¹é…

æ¸…ç†æ—§æ•°æ®ï¼š
```bash
rm -rf ./node1/data/geth
```

é‡æ–°åˆå§‹åŒ–ï¼š
```bash
geth --datadir ./node1/data init genesis.json
```

éªŒè¯ JSON æ ¼å¼ï¼š
```bash
cat genesis.json | jq '.'
```

### åˆ›ä¸–åŒºå—ä¸ä¸€è‡´

èŠ‚ç‚¹å‡ºç° `genesis mismatch` é”™è¯¯æ—¶ï¼Œç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ç›¸åŒé…ç½®ï¼š
```bash
md5sum genesis.json
```

å®Œå…¨é‡ç½®èŠ‚ç‚¹ï¼š
```bash
geth removedb --datadir ./node1/data
geth init --datadir ./node1/data genesis.json
```

## ğŸ” è´¦æˆ·ä¸å¯†é’¥

### è§£é”è´¦æˆ·

å¯åŠ¨æ—¶è§£é”ï¼š
```bash
geth --unlock "0xYourAddress" --password password.txt
```

æ§åˆ¶å°è§£é”ï¼š
```bash
geth attach
```
```javascript
> personal.unlockAccount(eth.accounts[0], "password", 0)
```

### å¤‡ä»½ Keystore

å®šæœŸå¤‡ä»½ï¼š
```bash
tar -czf keystore-backup-$(date +%Y%m%d).tar.gz ./node*/keystore
```

å¯¼å‡ºç§é’¥ï¼ˆè°¨æ…æ“ä½œï¼‰ï¼š
```bash
geth account export <address> --datadir ./node1/data
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### åŒæ­¥åŠ é€Ÿ

å¢åŠ ç¼“å­˜ï¼š
```bash
geth --cache 2048 --datadir ./node1/data
```

å¿«é€ŸåŒæ­¥æ¨¡å¼ï¼š
```bash
geth --syncmode "snap"
```

é™åˆ¶æ•°æ®åº“å¤§å°ï¼š
```bash
geth --cache.database 50
```

### ç£ç›˜ç©ºé—´ç®¡ç†

æ¸…ç†æ—§æ•°æ®ï¼š
```bash
geth removedb --datadir ./node1/data
```

å¯ç”¨æ—¥å¿—è½®è½¬ï¼š
```bash
geth --log.rotate --log.maxsize 100
```

## ğŸ“ æ™ºèƒ½åˆçº¦éƒ¨ç½²

### Gas ä¼°ç®—å¤±è´¥

æ‰‹åŠ¨è®¾ç½® gas å‚æ•°ï¼š
```javascript
const tx = await contract.deploy({
  gasLimit: 3000000,
  gasPrice: ethers.utils.parseUnits('1', 'gwei')
});
```

### åˆçº¦åœ°å€ä¸ºç©º

ç¡®ä¿èŠ‚ç‚¹æ­£åœ¨æŒ–çŸ¿ï¼š
```bash
geth attach
```
```javascript
> miner.start(1)
> eth.getTransactionReceipt("0xTxHash")
```

## ğŸ” è°ƒè¯•å·¥å…·

### æ—¥å¿—åˆ†æ

å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f ./node1/data/geth.log
```

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```bash
geth --verbosity 5 --log.debug
```

ç­›é€‰é”™è¯¯ä¿¡æ¯ï¼š
```bash
grep "ERROR" ./node1/data/geth.log
```

### å¥åº·æ£€æŸ¥

æµ‹è¯• RPC è¿æ¥ï¼š
```bash
curl -X POST http://localhost:8545 \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'
```

æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼š
```bash
geth attach --exec "eth.syncing" http://localhost:8545
```

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ |
|:-----|:-----|
| `geth version` | æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ |
| `geth account list --datadir <path>` | åˆ—å‡ºæ‰€æœ‰è´¦æˆ· |
| `geth console` | å¯åŠ¨äº¤äº’å¼æ§åˆ¶å° |
| `geth attach` | è¿æ¥è¿è¡Œä¸­çš„èŠ‚ç‚¹ |
| `admin.nodeInfo` | æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯ |
| `net.peerCount` | æŸ¥çœ‹è¿æ¥çš„èŠ‚ç‚¹æ•° |
| `eth.blockNumber` | æŸ¥çœ‹å½“å‰åŒºå—é«˜åº¦ |
| `miner.start()` / `miner.stop()` | å¯åŠ¨/åœæ­¢æŒ–çŸ¿ |

## ğŸ’¡ æœ€ä½³å®è·µ

- **æœåŠ¡ç®¡ç†**ï¼šä½¿ç”¨ systemd ç®¡ç†èŠ‚ç‚¹æœåŠ¡ï¼Œå®ç°å¼€æœºè‡ªå¯
- **ç›‘æ§å‘Šè­¦**ï¼šé…ç½® Prometheus + Grafana ç›‘æ§èŠ‚ç‚¹çŠ¶æ€
- **æ•°æ®å¤‡ä»½**ï¼šæ¯æ—¥å¤‡ä»½ keystore å’Œå…³é”®é…ç½®æ–‡ä»¶
- **ç¯å¢ƒéš”ç¦»**ï¼šä½¿ç”¨ Docker Compose å¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒ
- **ç‰ˆæœ¬é”å®š**ï¼šç”Ÿäº§ç¯å¢ƒå›ºå®šè½¯ä»¶ç‰ˆæœ¬å·ï¼Œé¿å…æ„å¤–å‡çº§
